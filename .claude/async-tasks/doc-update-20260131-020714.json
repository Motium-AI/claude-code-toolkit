{
  "type": "doc-update",
  "created_at": "2026-01-31T02:07:14.272554+00:00",
  "status": "pending",
  "commit_message": "docs: update for append-only memory event store\n\nUpdate documentation to reflect the new memory system architecture:\n- Memory events now stored in ~/.claude/memory/{project-hash}/events/\n- Auto-capture from stop-validator hook (primary memory capture path)\n- compound-context-loader reads from event store instead of docs/solutions/\n- No more solution-schema.md or docs/solutions/ directory\n- Simplified /compound skill (95 lines, down from 241)\n\nAdded new Memory System section to docs/index.md explaining:\n- Event store architecture and scoring (recency 60% + entity overlap 40%)\n- Auto-capture vs manual capture workflows\n- Project-scoped isolation via SHA256 hash\n- 90-day TTL and 500 event cap\n- JSON event schema and manual search instructions\n\nUpdated docs/architecture.md and docs/concepts/hooks.md to document\nstop-validator auto-capture functionality on successful stop.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
  "diff_content": "commit 66d803bc761bebd3aa98bc824ddca80805a068aa\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Sat Jan 31 03:07:14 2026 +0100\n\n    docs: update for append-only memory event store\n    \n    Update documentation to reflect the new memory system architecture:\n    - Memory events now stored in ~/.claude/memory/{project-hash}/events/\n    - Auto-capture from stop-validator hook (primary memory capture path)\n    - compound-context-loader reads from event store instead of docs/solutions/\n    - No more solution-schema.md or docs/solutions/ directory\n    - Simplified /compound skill (95 lines, down from 241)\n    \n    Added new Memory System section to docs/index.md explaining:\n    - Event store architecture and scoring (recency 60% + entity overlap 40%)\n    - Auto-capture vs manual capture workflows\n    - Project-scoped isolation via SHA256 hash\n    - 90-day TTL and 500 event cap\n    - JSON event schema and manual search instructions\n    \n    Updated docs/architecture.md and docs/concepts/hooks.md to document\n    stop-validator auto-capture functionality on successful stop.\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n docs/architecture.md   |  1 +\n docs/concepts/hooks.md |  5 ++++-\n docs/index.md          | 54 +++++++++++++++++++++++++++++++++++++++++++++-----\n 3 files changed, 54 insertions(+), 6 deletions(-)\n\ndiff --git a/docs/architecture.md b/docs/architecture.md\nindex 3c4a67f..a2ba618 100644\n--- a/docs/architecture.md\n+++ b/docs/architecture.md\n@@ -202,6 +202,7 @@ The stop-validator.py hook:\n    - Outputs checklist to stderr\n    - Returns exit code 2 (block)\n 3. If `stop_hook_active: true` (second stop attempt):\n+   - Auto-captures checkpoint as memory event to `~/.claude/memory/{project-hash}/events/`\n    - Returns exit code 0 (allow)\n \n **Loop Prevention**: The `stop_hook_active` flag prevents infinite loops:\ndiff --git a/docs/concepts/hooks.md b/docs/concepts/hooks.md\nindex 801092c..85e0987 100644\n--- a/docs/concepts/hooks.md\n+++ b/docs/concepts/hooks.md\n@@ -549,7 +549,7 @@ Location: `~/.claude/hooks/stop-validator.py`\n The stop validator implements two-phase blocking with execution validation:\n \n **Phase 1 (First Stop)**: Shows full compliance checklist with plan verification and change-specific testing\n-**Phase 2 (Second Stop)**: Validates execution requirements before allowing stop\n+**Phase 2 (Second Stop)**: Validates execution requirements, auto-captures checkpoint as memory event, then allows stop\n \n ```python\n #!/usr/bin/env python3\n@@ -596,6 +596,8 @@ def main():\n         if not execution_ok:\n             print(f\"\u274c BLOCKED: {msg}\", file=sys.stderr)\n             sys.exit(2)\n+        # Auto-capture checkpoint as memory event\n+        capture_memory_event(cwd, session_id)\n         sys.exit(0)  # All requirements met\n \n     # FIRST STOP: Show FULL checklist with plan and change detection\n@@ -611,6 +613,7 @@ Key features:\n - **Frontend change detection**: Auto-requires browser testing for .tsx/.jsx changes\n - **Testing state tracking**: Reads `.claude/testing-state.json` to verify /webtest ran\n - **Second stop enforcement**: Blocks if requirements not met (prevents bypass)\n+- **Memory auto-capture**: Archives checkpoint as memory event to `~/.claude/memory/{project-hash}/events/`\n - **Infrastructure bypass**: Skips web testing for infrastructure-only changes\n \n #### Infrastructure Bypass\ndiff --git a/docs/index.md b/docs/index.md\nindex 2351f1a..b7b6d29 100644\n--- a/docs/index.md\n+++ b/docs/index.md\n@@ -70,7 +70,7 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n | `/weboptimizer` | Performance benchmarking |\n | `/designimprove` | UI improvement |\n | `/uximprove` | UX improvement |\n-| `/compound` | Capture solved problems as structured markdown for cross-session learning |\n+| `/compound` | Capture solved problems as memory events for cross-session learning |\n \n ## All Skills (25 total)\n \n@@ -106,7 +106,7 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n \n | Event | Scripts | Purpose |\n |-------|---------|---------|\n-| SessionStart | auto-update, session-snapshot, compound-context-loader, read-docs-reminder | Init, context injection, toolkit update |\n+| SessionStart | auto-update, session-snapshot, compound-context-loader, read-docs-reminder | Init, memory injection, toolkit update |\n | UserPromptSubmit | skill-state-initializer, read-docs-trigger | State files and doc suggestions |\n | PreToolUse (*) | pretooluse-auto-approve | Auto-approve during autonomous mode |\n | PreToolUse (Edit/Write) | plan-mode-enforcer | Block until plan done |\n@@ -118,11 +118,51 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n | PostToolUse (Bash) | bash-version-tracker, doc-updater-async | Track versions, suggest doc updates |\n | PostToolUse (ExitPlanMode) | plan-mode-tracker, plan-execution-reminder | Mark plan done, inject context |\n | PostToolUse (Skill) | skill-continuation-reminder | Continue loop after skill |\n-| Stop | stop-validator | Validate checkpoint |\n+| Stop | stop-validator | Validate checkpoint, auto-capture memory event |\n | PermissionRequest | permissionrequest-auto-approve | Auto-approve during autonomous mode |\n \n ---\n \n+## Memory System\n+\n+**Append-only event store** for cross-session learning. Events stored in `~/.claude/memory/{project-hash}/events/`.\n+\n+### How It Works\n+\n+1. **Auto-capture** (primary path): `stop-validator` hook archives checkpoint as memory event on every successful stop\n+2. **Manual capture** (deep captures): `/compound` skill for detailed problem documentation\n+3. **Auto-injection**: `compound-context-loader` hook injects top 5 relevant events at SessionStart\n+4. **Scoring**: Events ranked by recency (60%) + entity overlap (40%)\n+\n+### Storage\n+\n+- **Location**: `~/.claude/memory/{project-hash}/events/evt_{timestamp}.json`\n+- **Isolation**: Project-scoped via SHA256(git_remote_url | repo_root)\n+- **Retention**: 90-day TTL, 500 event cap per project\n+- **Format**: JSON events with atomic writes (F_FULLFSYNC + os.replace for crash safety)\n+\n+### Event Schema\n+\n+```json\n+{\n+  \"id\": \"evt_20260131T143022-12345-a1b2c3\",\n+  \"ts\": \"2026-01-31T14:30:22Z\",\n+  \"type\": \"compound\",\n+  \"content\": \"Learning summary (1-5 sentences)\",\n+  \"entities\": [\"file.py\", \"concept\", \"tool\"],\n+  \"source\": \"compound\",\n+  \"meta\": {\"session_context\": \"...\"}\n+}\n+```\n+\n+### Manual Search\n+\n+```bash\n+grep -riwl \"keyword\" ~/.claude/memory/*/events/\n+```\n+\n+---\n+\n ## Deep Dives\n \n | Document | Description |\n@@ -151,10 +191,14 @@ namshub/        # THIS IS THE SOURCE OF TRUTH\n \u251c\u2500\u2500 scripts/                   # install.sh, doctor.sh\n \u2514\u2500\u2500 README.md\n \n-~/.claude/                     # SYMLINKED TO REPO\n+~/.claude/                     # SYMLINKED TO REPO + MEMORY\n \u251c\u2500\u2500 skills \u2192 config/skills     # Symlink - edits here go to repo\n \u251c\u2500\u2500 hooks \u2192 config/hooks       # Symlink - edits here go to repo\n-\u2514\u2500\u2500 settings.json \u2192 config/settings.json\n+\u251c\u2500\u2500 settings.json \u2192 config/settings.json\n+\u2514\u2500\u2500 memory/                    # Event store (NOT in repo)\n+    \u2514\u2500\u2500 {project-hash}/\n+        \u251c\u2500\u2500 events/            # Memory events (JSON)\n+        \u2514\u2500\u2500 manifest.json      # Fast lookup index\n ```\n \n **IMPORTANT**: `~/.claude/skills/` is a symlink to `config/skills/` in this repo. When you edit skill files, you're editing the repo. Commit changes to preserve them.",
  "existing_docs": [
    "docs/architecture.md",
    "docs/analysis-persistent-memory-for-harnesses.md",
    "docs/index.md",
    "docs/memory-integration-analysis.md",
    "docs/philosophy.md",
    "docs/audiobook-the-amnesiac-architect.md",
    "README.md",
    ".claude/MEMORIES.md"
  ],
  "instructions": "\nDOCUMENTATION UPDATE TASK\n\nA commit was just made in an repair/build session. Your job is to:\n\n1. Analyze the diff to understand what changed\n2. Determine which documentation files need updating\n3. Update the relevant docs to reflect the changes\n\nCOMMIT MESSAGE:\ndocs: update for append-only memory event store\n\nUpdate documentation to reflect the new memory system architecture:\n- Memory events now stored in ~/.claude/memory/{project-hash}/events/\n- Auto-capture from stop-validator hook (primary memory capture path)\n- compound-context-loader reads from event store instead of docs/solutions/\n- No more solution-schema.md or docs/solutions/ directory\n- Simplified /compound skill (95 lines, down from 241)\n\nAdded new Memory System section to docs/index.md explaining:\n- Event store architecture and scoring (recency 60% + entity overlap 40%)\n- Auto-capture vs manual capture workflows\n- Project-scoped isolation via SHA256 hash\n- 90-day TTL and 500 event cap\n- JSON event schema and manual search instructions\n\nUpdated docs/architecture.md and docs/concepts/hooks.md to document\nstop-validator auto-capture functionality on successful stop.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\nEXISTING DOCUMENTATION FILES:\n- docs/architecture.md\n- docs/analysis-persistent-memory-for-harnesses.md\n- docs/index.md\n- docs/memory-integration-analysis.md\n- docs/philosophy.md\n- docs/audiobook-the-amnesiac-architect.md\n- README.md\n- .claude/MEMORIES.md\n\nDIFF CONTENT:\ncommit 66d803bc761bebd3aa98bc824ddca80805a068aa\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Sat Jan 31 03:07:14 2026 +0100\n\n    docs: update for append-only memory event store\n    \n    Update documentation to reflect the new memory system architecture:\n    - Memory events now stored in ~/.claude/memory/{project-hash}/events/\n    - Auto-capture from stop-validator hook (primary memory capture path)\n    - compound-context-loader reads from event store instead of docs/solutions/\n    - No more solution-schema.md or docs/solutions/ directory\n    - Simplified /compound skill (95 lines, down from 241)\n    \n    Added new Memory System section to docs/index.md explaining:\n    - Event store architecture and scoring (recency 60% + entity overlap 40%)\n    - Auto-capture vs manual capture workflows\n    - Project-scoped isolation via SHA256 hash\n    - 90-day TTL and 500 event cap\n    - JSON event schema and manual search instructions\n    \n    Updated docs/architecture.md and docs/concepts/hooks.md to document\n    stop-validator auto-capture functionality on successful stop.\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n docs/architecture.md   |  1 +\n docs/concepts/hooks.md |  5 ++++-\n docs/index.md          | 54 +++++++++++++++++++++++++++++++++++++++++++++-----\n 3 files changed, 54 insertions(+), 6 deletions(-)\n\ndiff --git a/docs/architecture.md b/docs/architecture.md\nindex 3c4a67f..a2ba618 100644\n--- a/docs/architecture.md\n+++ b/docs/architecture.md\n@@ -202,6 +202,7 @@ The stop-validator.py hook:\n    - Outputs checklist to stderr\n    - Returns exit code 2 (block)\n 3. If `stop_hook_active: true` (second stop attempt):\n+   - Auto-captures checkpoint as memory event to `~/.claude/memory/{project-hash}/events/`\n    - Returns exit code 0 (allow)\n \n **Loop Prevention**: The `stop_hook_active` flag prevents infinite loops:\ndiff --git a/docs/concepts/hooks.md b/docs/concepts/hooks.md\nindex 801092c..85e0987 100644\n--- a/docs/concepts/hooks.md\n+++ b/docs/concepts/hooks.md\n@@ -549,7 +549,7 @@ Location: `~/.claude/hooks/stop-validator.py`\n The stop validator implements two-phase blocking with execution validation:\n \n **Phase 1 (First Stop)**: Shows full compliance checklist with plan verification and change-specific testing\n-**Phase 2 (Second Stop)**: Validates execution requirements before allowing stop\n+**Phase 2 (Second Stop)**: Validates execution requirements, auto-captures checkpoint as memory event, then allows stop\n \n ```python\n #!/usr/bin/env python3\n@@ -596,6 +596,8 @@ def main():\n         if not execution_ok:\n             print(f\"\u274c BLOCKED: {msg}\", file=sys.stderr)\n             sys.exit(2)\n+        # Auto-capture checkpoint as memory event\n+        capture_memory_event(cwd, session_id)\n         sys.exit(0)  # All requirements met\n \n     # FIRST STOP: Show FULL checklist with plan and change detection\n@@ -611,6 +613,7 @@ Key features:\n - **Frontend change detection**: Auto-requires browser testing for .tsx/.jsx changes\n - **Testing state tracking**: Reads `.claude/testing-state.json` to verify /webtest ran\n - **Second stop enforcement**: Blocks if requirements not met (prevents bypass)\n+- **Memory auto-capture**: Archives checkpoint as memory event to `~/.claude/memory/{project-hash}/events/`\n - **Infrastructure bypass**: Skips web testing for infrastructure-only changes\n \n #### Infrastructure Bypass\ndiff --git a/docs/index.md b/docs/index.md\nindex 2351f1a..b7b6d29 100644\n--- a/docs/index.md\n+++ b/docs/index.md\n@@ -70,7 +70,7 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n | `/weboptimizer` | Performance benchmarking |\n | `/designimprove` | UI improvement |\n | `/uximprove` | UX improvement |\n-| `/compound` | Capture solved problems as structured markdown for cross-session learning |\n+| `/compound` | Capture solved problems as memory events for cross-session learning |\n \n ## All Skills (25 total)\n \n@@ -106,7 +106,7 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n \n | Event | Scripts | Purpose |\n |-------|---------|---------|\n-| SessionStart | auto-update, session-snapshot, compound-context-loader, read-docs-reminder | Init, context injection, toolkit update |\n+| SessionStart | auto-update, session-snapshot, compound-context-loader, read-docs-reminder | Init, memory injection, toolkit update |\n | UserPromptSubmit | skill-state-initializer, read-docs-trigger | State files and doc suggestions |\n | PreToolUse (*) | pretooluse-auto-approve | Auto-approve during autonomous mode |\n | PreToolUse (Edit/Write) | plan-mode-enforcer | Block until plan done |\n@@ -118,11 +118,51 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n | PostToolUse (Bash) | bash-version-tracker, doc-updater-async | Track versions, suggest doc updates |\n | PostToolUse (ExitPlanMode) | plan-mode-tracker, plan-execution-reminder | Mark plan done, inject context |\n | PostToolUse (Skill) | skill-continuation-reminder | Continue loop after skill |\n-| Stop | stop-validator | Validate checkpoint |\n+| Stop | stop-validator | Validate checkpoint, auto-capture memory event |\n | PermissionRequest | permissionrequest-auto-approve | Auto-approve during autonomous mode |\n \n ---\n \n+## Memory System\n+\n+**Append-only event store** for cross-session learning. Events stored in `~/.claude/memory/{project-hash}/events/`.\n+\n+### How It Works\n+\n+1. **Auto-capture** (primary path): `stop-validator` hook archives checkpoint as memory event on every successful stop\n+2. **Manual capture** (deep captures): `/compound` skill for detailed problem documentation\n+3. **Auto-injection**: `compound-context-loader` hook injects top 5 relevant events at SessionStart\n+4. **Scoring**: Events ranked by recency (60%) + entity overlap (40%)\n+\n+### Storage\n+\n+- **Location**: `~/.claude/memory/{project-hash}/events/evt_{timestamp}.json`\n+- **Isolation**: Project-scoped via SHA256(git_remote_url | repo_root)\n+- **Retention**: 90-day TTL, 500 event cap per project\n+- **Format**: JSON events with atomic writes (F_FULLFSYNC + os.replace for crash safety)\n+\n+### Event Schema\n+\n+```json\n+{\n+  \"id\": \"evt_20260131T143022-12345-a1b2c3\",\n+  \"ts\": \"2026-01-31T14:30:22Z\",\n+  \"type\": \"compound\",\n+  \"content\": \"Learning summary (1-5 sentences)\",\n+  \"entities\": [\"file.py\", \"concept\", \"tool\"],\n+  \"source\": \"compound\",\n+  \"meta\": {\"session_context\": \"...\"}\n+}\n+```\n+\n+### Manual Search\n+\n+```bash\n+grep -riwl \"keyword\" ~/.claude/memory/*/events/\n+```\n+\n+---\n+\n ## Deep Dives\n \n | Document | Description |\n@@ -151,10 +191,14 @@ namshub/        # THIS IS THE SOURCE OF TRUTH\n \u251c\u2500\u2500 scripts/                   # install.sh, doctor.sh\n \u2514\u2500\u2500 README.md\n \n-~/.claude/                     # SYMLINKED TO REPO\n+~/.claude/                     # SYMLINKED TO REPO + MEMORY\n \u251c\u2500\u2500 skills \u2192 config/skills     # Symlink - edits here go to repo\n \u251c\u2500\u2500 hooks \u2192 config/hooks       # Symlink - edits here go to repo\n-\u2514\u2500\u2500 settings.json \u2192 config/settings.json\n+\u251c\u2500\u2500 settings.json \u2192 config/settings.json\n+\u2514\u2500\u2500 memory/                    # Event store (NOT in repo)\n+    \u2514\u2500\u2500 {project-hash}/\n+        \u251c\u2500\u2500 events/            # Memory events (JSON)\n+        \u2514\u2500\u2500 manifest.json      # Fast lookup index\n ```\n \n **IMPORTANT**: `~/.claude/skills/` is a symlink to `config/skills/` in this repo. When you edit skill files, you're editing the repo. Commit changes to preserve them.\n\nINSTRUCTIONS:\n- Only update docs that are actually affected by this change\n- Keep updates concise and accurate\n- Don't add unnecessary documentation\n- If the change is purely code (no architectural/API changes), you may skip doc updates\n- Focus on: API changes, new features, architectural decisions, configuration changes\n\nUse the /heavy skill if you need multiple perspectives on what to document.\n"
}