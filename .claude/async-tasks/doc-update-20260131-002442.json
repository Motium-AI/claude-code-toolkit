{
  "type": "doc-update",
  "created_at": "2026-01-31T00:24:42.991380+00:00",
  "status": "pending",
  "commit_message": "feat(hooks): add /repair support to lite-heavy planning hooks\n\nExtends the Lite Heavy planning system to support /repair with 3 agents\n(vs 4 for /build):\n- Research Agent (root cause analysis)\n- First Principles (simplification lens)\n- 1 dynamic debugging perspective\n\nChanges:\n- lite-heavy-enforcer.py: Add SKILL_AGENT_REQUIREMENTS config for build/repair,\n  skill-specific blocking messages\n- lite-heavy-tracker.py: Add appfix-state.json to state file searches,\n  add research agent detection keywords\n- plan-mode-enforcer.py: Add 30-minute staleness detection to prevent\n  iteration-based skip for stale sessions\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
  "diff_content": "commit c5afcbb5961167e7074d90e5042a80207ff3adbb\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Sat Jan 31 01:24:42 2026 +0100\n\n    feat(hooks): add /repair support to lite-heavy planning hooks\n    \n    Extends the Lite Heavy planning system to support /repair with 3 agents\n    (vs 4 for /build):\n    - Research Agent (root cause analysis)\n    - First Principles (simplification lens)\n    - 1 dynamic debugging perspective\n    \n    Changes:\n    - lite-heavy-enforcer.py: Add SKILL_AGENT_REQUIREMENTS config for build/repair,\n      skill-specific blocking messages\n    - lite-heavy-tracker.py: Add appfix-state.json to state file searches,\n      add research agent detection keywords\n    - plan-mode-enforcer.py: Add 30-minute staleness detection to prevent\n      iteration-based skip for stale sessions\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/lite-heavy-enforcer.py | 148 +++++++++++++++---------------------\n config/hooks/lite-heavy-tracker.py  |  75 +++++-------------\n config/hooks/plan-mode-enforcer.py  | 125 +++++++++++-------------------\n 3 files changed, 121 insertions(+), 227 deletions(-)\n\ndiff --git a/config/hooks/lite-heavy-enforcer.py b/config/hooks/lite-heavy-enforcer.py\nindex 218a10c..333a224 100644\n--- a/config/hooks/lite-heavy-enforcer.py\n+++ b/config/hooks/lite-heavy-enforcer.py\n@@ -1,21 +1,12 @@\n #!/usr/bin/env python3\n \"\"\"\n-PreToolUse hook to enforce Lite Heavy execution before ExitPlanMode for /build.\n+PreToolUse hook to enforce Lite Heavy execution before ExitPlanMode for /build and /repair.\n \n-Blocks ExitPlanMode until ALL 4 agents have been launched:\n-1. heavy/SKILL.md has been read\n-2. \"First Principles\" Task agent has been launched\n-3. \"AGI-Pilled\" Task agent has been launched\n-4. 2 dynamic Task agents have been launched (task-specific perspectives)\n-\n-The tracking is done by lite-heavy-tracker.py (PostToolUse hook).\n-This hook only checks the state and blocks if requirements aren't met.\n+For /build: Blocks ExitPlanMode until ALL 4 agents have been launched.\n+For /repair: Blocks ExitPlanMode until 3 agents have been launched.\n \n Hook event: PreToolUse\n Matcher: ExitPlanMode\n-\n-Exit codes:\n-  0 - Decision made (deny via hookSpecificOutput or silent passthrough)\n \"\"\"\n \n from __future__ import annotations\n@@ -25,44 +16,39 @@ import os\n import sys\n from pathlib import Path\n \n-# Add hooks directory to path for shared imports\n sys.path.insert(0, str(Path(__file__).parent))\n from _common import log_debug\n from _state import get_autonomous_state\n \n+SKILL_AGENT_REQUIREMENTS = {\n+    \"build\": {\"heavy_skill_read\": True, \"first_principles_launched\": True, \n+              \"agi_pilled_launched\": True, \"dynamic_agents_required\": 2},\n+    \"repair\": {\"heavy_skill_read\": True, \"research_launched\": True,\n+               \"first_principles_launched\": True, \"dynamic_agents_required\": 1},\n+}\n \n-BLOCK_MESSAGE = \"\"\"\n-\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n-\u2551  \u26a0\ufe0f  LITE HEAVY PLANNING REQUIRED - /build                                    \u2551\n-\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n+BLOCK_MESSAGE_BUILD = \"\"\"\n+LITE HEAVY PLANNING REQUIRED - /build\n \n Before exiting plan mode, you MUST launch ALL 4 Opus agents.\n \n-\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n-\u2502  REQUIRED STEPS:                                                                \u2502\n-\u2502                                                                                 \u2502\n-\u2502  {step1}  1. Read ~/.claude/skills/heavy/SKILL.md (get agent prompts)           \u2502\n-\u2502  {step2}  2. Launch Task: \"First Principles Analysis\" (from heavy)              \u2502\n-\u2502  {step3}  3. Launch Task: \"AGI-Pilled Analysis\" (from heavy)                    \u2502\n-\u2502  {step4}  4. Launch 2 dynamic Task agents (task-specific perspectives)          \u2502\n-\u2502           ({dynamic_count}/2 launched)                                          \u2502\n-\u2502  5. Synthesize ALL 4 agents' responses into your plan                           \u2502\n-\u2502                                                                                 \u2502\n-\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n-\n-\u26a0\ufe0f  CRITICAL: Launch ALL 4 agents in a SINGLE message (one message, four Task calls).\n-Do NOT launch them one at a time. They must run in PARALLEL.\n-\n-Dynamic agents = task-specific perspectives. Ask:\n-\"For THIS task, who would argue about it at a company meeting?\"\n-Pick 2 perspectives that catch what First Principles and AGI-Pilled miss.\n-Use \"perspective\", \"analysis\", \"review\", or \"expert\" in the Task description.\n-\n-WHY 4 AGENTS?\n-- First Principles: \"What can be deleted? What's over-engineered?\"\n-- AGI-Pilled: \"What would god-tier AI implementation look like?\"\n-- Dynamic 1: Domain expertise \u2014 \"What does [expert] see?\"\n-- Dynamic 2: Adversarial review \u2014 \"What could go wrong?\"\n+{step1} 1. Read ~/.claude/skills/heavy/SKILL.md\n+{step2} 2. Launch Task: \"First Principles Analysis\"\n+{step3} 3. Launch Task: \"AGI-Pilled Analysis\"\n+{step4} 4. Launch 2 dynamic Task agents ({dynamic_count}/2 launched)\n+\n+Complete ALL missing steps, then ExitPlanMode again.\n+\"\"\".strip()\n+\n+BLOCK_MESSAGE_REPAIR = \"\"\"\n+LITE HEAVY PLANNING REQUIRED - /repair\n+\n+Before exiting plan mode, you MUST launch ALL 3 Opus agents for debugging.\n+\n+{step1} 1. Read ~/.claude/skills/appfix/heavy/SKILL.md\n+{step2} 2. Launch Task: \"Research Agent: Root cause analysis\"\n+{step3} 3. Launch Task: \"First Principles Analysis\"\n+{step4} 4. Launch 1 dynamic Task agent ({dynamic_count}/1 launched)\n \n Complete ALL missing steps, then ExitPlanMode again.\n \"\"\".strip()\n@@ -79,71 +65,57 @@ def main():\n     tool_name = input_data.get(\"tool_name\", \"\")\n     session_id = input_data.get(\"session_id\", \"\")\n \n-    # Only process ExitPlanMode\n     if tool_name != \"ExitPlanMode\":\n         sys.exit(0)\n \n-    # Only process if build is active\n     state, state_type = get_autonomous_state(cwd, session_id)\n-    if state_type != \"build\":\n+    if state_type not in (\"build\", \"repair\"):\n         sys.exit(0)\n \n-    # Only enforce on first iteration\n     iteration = state.get(\"iteration\", 1)\n     if iteration > 1:\n         sys.exit(0)\n \n-    # Check Lite Heavy requirements\n     lite_heavy = state.get(\"lite_heavy_verification\", {})\n     heavy_skill_read = lite_heavy.get(\"heavy_skill_read\", False)\n     first_principles_launched = lite_heavy.get(\"first_principles_launched\", False)\n     agi_pilled_launched = lite_heavy.get(\"agi_pilled_launched\", False)\n+    research_launched = lite_heavy.get(\"research_launched\", False)\n     dynamic_agents_launched = lite_heavy.get(\"dynamic_agents_launched\", 0)\n \n-    # If all requirements met, allow ExitPlanMode\n-    all_met = (\n-        heavy_skill_read\n-        and first_principles_launched\n-        and agi_pilled_launched\n-        and dynamic_agents_launched >= 2\n-    )\n+    requirements = SKILL_AGENT_REQUIREMENTS.get(state_type, SKILL_AGENT_REQUIREMENTS[\"build\"])\n+    dynamic_required = requirements.get(\"dynamic_agents_required\", 2)\n+\n+    if state_type == \"repair\":\n+        all_met = (heavy_skill_read and research_launched and first_principles_launched\n+                   and dynamic_agents_launched >= dynamic_required)\n+    else:\n+        all_met = (heavy_skill_read and first_principles_launched and agi_pilled_launched\n+                   and dynamic_agents_launched >= dynamic_required)\n+\n     if all_met:\n-        log_debug(\n-            \"Lite Heavy requirements met (4 agents), allowing ExitPlanMode\",\n-            hook_name=\"lite-heavy-enforcer\"\n-        )\n+        log_debug(\"Lite Heavy requirements met, allowing ExitPlanMode\", hook_name=\"lite-heavy-enforcer\")\n         sys.exit(0)\n \n-    # Block with specific feedback\n-    step1 = \"\u2713\" if heavy_skill_read else \"\u2717\"\n-    step2 = \"\u2713\" if first_principles_launched else \"\u2717\"\n-    step3 = \"\u2713\" if agi_pilled_launched else \"\u2717\"\n-    step4 = \"\u2713\" if dynamic_agents_launched >= 2 else \"\u2717\"\n-\n\n... [truncated - diff too long]",
  "existing_docs": [
    "docs/architecture.md",
    "docs/analysis-persistent-memory-for-harnesses.md",
    "docs/index.md",
    "docs/memory-integration-analysis.md",
    "docs/philosophy.md",
    "docs/audiobook-the-amnesiac-architect.md",
    "README.md",
    ".claude/MEMORIES.md"
  ],
  "instructions": "\nDOCUMENTATION UPDATE TASK\n\nA commit was just made in an repair/build session. Your job is to:\n\n1. Analyze the diff to understand what changed\n2. Determine which documentation files need updating\n3. Update the relevant docs to reflect the changes\n\nCOMMIT MESSAGE:\nfeat(hooks): add /repair support to lite-heavy planning hooks\n\nExtends the Lite Heavy planning system to support /repair with 3 agents\n(vs 4 for /build):\n- Research Agent (root cause analysis)\n- First Principles (simplification lens)\n- 1 dynamic debugging perspective\n\nChanges:\n- lite-heavy-enforcer.py: Add SKILL_AGENT_REQUIREMENTS config for build/repair,\n  skill-specific blocking messages\n- lite-heavy-tracker.py: Add appfix-state.json to state file searches,\n  add research agent detection keywords\n- plan-mode-enforcer.py: Add 30-minute staleness detection to prevent\n  iteration-based skip for stale sessions\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\nEXISTING DOCUMENTATION FILES:\n- docs/architecture.md\n- docs/analysis-persistent-memory-for-harnesses.md\n- docs/index.md\n- docs/memory-integration-analysis.md\n- docs/philosophy.md\n- docs/audiobook-the-amnesiac-architect.md\n- README.md\n- .claude/MEMORIES.md\n\nDIFF CONTENT:\ncommit c5afcbb5961167e7074d90e5042a80207ff3adbb\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Sat Jan 31 01:24:42 2026 +0100\n\n    feat(hooks): add /repair support to lite-heavy planning hooks\n    \n    Extends the Lite Heavy planning system to support /repair with 3 agents\n    (vs 4 for /build):\n    - Research Agent (root cause analysis)\n    - First Principles (simplification lens)\n    - 1 dynamic debugging perspective\n    \n    Changes:\n    - lite-heavy-enforcer.py: Add SKILL_AGENT_REQUIREMENTS config for build/repair,\n      skill-specific blocking messages\n    - lite-heavy-tracker.py: Add appfix-state.json to state file searches,\n      add research agent detection keywords\n    - plan-mode-enforcer.py: Add 30-minute staleness detection to prevent\n      iteration-based skip for stale sessions\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/lite-heavy-enforcer.py | 148 +++++++++++++++---------------------\n config/hooks/lite-heavy-tracker.py  |  75 +++++-------------\n config/hooks/plan-mode-enforcer.py  | 125 +++++++++++-------------------\n 3 files changed, 121 insertions(+), 227 deletions(-)\n\ndiff --git a/config/hooks/lite-heavy-enforcer.py b/config/hooks/lite-heavy-enforcer.py\nindex 218a10c..333a224 100644\n--- a/config/hooks/lite-heavy-enforcer.py\n+++ b/config/hooks/lite-heavy-enforcer.py\n@@ -1,21 +1,12 @@\n #!/usr/bin/env python3\n \"\"\"\n-PreToolUse hook to enforce Lite Heavy execution before ExitPlanMode for /build.\n+PreToolUse hook to enforce Lite Heavy execution before ExitPlanMode for /build and /repair.\n \n-Blocks ExitPlanMode until ALL 4 agents have been launched:\n-1. heavy/SKILL.md has been read\n-2. \"First Principles\" Task agent has been launched\n-3. \"AGI-Pilled\" Task agent has been launched\n-4. 2 dynamic Task agents have been launched (task-specific perspectives)\n-\n-The tracking is done by lite-heavy-tracker.py (PostToolUse hook).\n-This hook only checks the state and blocks if requirements aren't met.\n+For /build: Blocks ExitPlanMode until ALL 4 agents have been launched.\n+For /repair: Blocks ExitPlanMode until 3 agents have been launched.\n \n Hook event: PreToolUse\n Matcher: ExitPlanMode\n-\n-Exit codes:\n-  0 - Decision made (deny via hookSpecificOutput or silent passthrough)\n \"\"\"\n \n from __future__ import annotations\n@@ -25,44 +16,39 @@ import os\n import sys\n from pathlib import Path\n \n-# Add hooks directory to path for shared imports\n sys.path.insert(0, str(Path(__file__).parent))\n from _common import log_debug\n from _state import get_autonomous_state\n \n+SKILL_AGENT_REQUIREMENTS = {\n+    \"build\": {\"heavy_skill_read\": True, \"first_principles_launched\": True, \n+              \"agi_pilled_launched\": True, \"dynamic_agents_required\": 2},\n+    \"repair\": {\"heavy_skill_read\": True, \"research_launched\": True,\n+               \"first_principles_launched\": True, \"dynamic_agents_required\": 1},\n+}\n \n-BLOCK_MESSAGE = \"\"\"\n-\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n-\u2551  \u26a0\ufe0f  LITE HEAVY PLANNING REQUIRED - /build                                    \u2551\n-\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n+BLOCK_MESSAGE_BUILD = \"\"\"\n+LITE HEAVY PLANNING REQUIRED - /build\n \n Before exiting plan mode, you MUST launch ALL 4 Opus agents.\n \n-\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n-\u2502  REQUIRED STEPS:                                                                \u2502\n-\u2502                                                                                 \u2502\n-\u2502  {step1}  1. Read ~/.claude/skills/heavy/SKILL.md (get agent prompts)           \u2502\n-\u2502  {step2}  2. Launch Task: \"First Principles Analysis\" (from heavy)              \u2502\n-\u2502  {step3}  3. Launch Task: \"AGI-Pilled Analysis\" (from heavy)                    \u2502\n-\u2502  {step4}  4. Launch 2 dynamic Task agents (task-specific perspectives)          \u2502\n-\u2502           ({dynamic_count}/2 launched)                                          \u2502\n-\u2502  5. Synthesize ALL 4 agents' responses into your plan                           \u2502\n-\u2502                                                                                 \u2502\n-\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n-\n-\u26a0\ufe0f  CRITICAL: Launch ALL 4 agents in a SINGLE message (one message, four Task calls).\n-Do NOT launch them one at a time. They must run in PARALLEL.\n-\n-Dynamic agents = task-specific perspectives. Ask:\n-\"For THIS task, who would argue about it at a company meeting?\"\n-Pick 2 perspectives that catch what First Principles and AGI-Pilled miss.\n-Use \"perspective\", \"analysis\", \"review\", or \"expert\" in the Task description.\n-\n-WHY 4 AGENTS?\n-- First Principles: \"What can be deleted? What's over-engineered?\"\n-- AGI-Pilled: \"What would god-tier AI implementation look like?\"\n-- Dynamic 1: Domain expertise \u2014 \"What does [expert] see?\"\n-- Dynamic 2: Adversarial review \u2014 \"What could go wrong?\"\n+{step1} 1. Read ~/.claude/skills/heavy/SKILL.md\n+{step2} 2. Launch Task: \"First Principles Analysis\"\n+{step3} 3. Launch Task: \"AGI-Pilled Analysis\"\n+{step4} 4. Launch 2 dynamic Task agents ({dynamic_count}/2 launched)\n+\n+Complete ALL missing steps, then ExitPlanMode again.\n+\"\"\".strip()\n+\n+BLOCK_MESSAGE_REPAIR = \"\"\"\n+LITE HEAVY PLANNING REQUIRED - /repair\n+\n+Before exiting plan mode, you MUST launch ALL 3 Opus agents for debugging.\n+\n+{step1} 1. Read ~/.claude/skills/appfix/heavy/SKILL.md\n+{step2} 2. Launch Task: \"Research Agent: Root cause analysis\"\n+{step3} 3. Launch Task: \"First Principles Analysis\"\n+{step4} 4. Launch 1 dynamic Task agent ({dynamic_count}/1 launched)\n \n Complete ALL missing steps, then ExitPlanMode again.\n \"\"\".strip()\n@@ -79,71 +65,57 @@ def main():\n     tool_name = input_data.get(\"tool_name\", \"\")\n     session_id = input_data.get(\"session_id\", \"\")\n \n-    # Only process ExitPlanMode\n     if tool_name != \"ExitPlanMode\":\n         sys.exit(0)\n \n-    # Only process if build is active\n     state, state_type = get_autonomous_state(cwd, session_id)\n-    if state_type != \"build\":\n+    if state_type not in (\"build\", \"repair\"):\n         sys.exit(0)\n \n-    # Only enforce on first iteration\n     iteration = state.get(\"iteration\", 1)\n     if iteration > 1:\n         sys.exit(0)\n \n-    # Check Lite Heavy requirements\n     lite_heavy = state.get(\"lite_heavy_verification\", {})\n     heavy_skill_read = lite_heavy.get(\"heavy_skill_read\", False)\n     first_principles_launched = lite_heavy.get(\"first_principles_launched\", False)\n     agi_pilled_launched = lite_heavy.get(\"agi_pilled_launched\", False)\n+    research_launched = lite_heavy.get(\"research_launched\", False)\n     dynamic_agents_launched = lite_heavy.get(\"dynamic_agents_launched\", 0)\n \n-    # If all requirements met, allow ExitPlanMode\n-    all_met = (\n-        heavy_skill_read\n-        and first_principles_launched\n-        and agi_pilled_launched\n-        and dynamic_agents_launched >= 2\n-    )\n+    requirements = SKILL_AGENT_REQUIREMENTS.get(state_type, SKILL_AGENT_REQUIREMENTS[\"build\"])\n+    dynamic_required = requirements.get(\"dynamic_agents_required\", 2)\n+\n+    if state_type == \"repair\":\n+        all_met = (heavy_skill_read and research_launched and first_principles_launched\n+                   and dynamic_agents_launched >= dynamic_required)\n+    else:\n+        all_met = (heavy_skill_read and first_principles_launched and agi_pilled_launched\n+                   and dynamic_agents_launched >= dynamic_required)\n+\n     if all_met:\n-        log_debug(\n-            \"Lite Heavy requirements met (4 agents), allowing ExitPlanMode\",\n-            hook_name=\"lite-heavy-enforcer\"\n-        )\n+        log_debug(\"Lite Heavy requirements met, allowing ExitPlanMode\", hook_name=\"lite-heavy-enforcer\")\n         sys.exit(0)\n \n-    # Block with specific feedback\n-    step1 = \"\u2713\" if heavy_skill_read else \"\u2717\"\n-    step2 = \"\u2713\" if first_principles_launched else \"\u2717\"\n-    step3 = \"\u2713\" if agi_pilled_launched else \"\u2717\"\n-    step4 = \"\u2713\" if dynamic_agents_launched >= 2 else \"\u2717\"\n-\n\n... [truncated - diff too long]\n\nINSTRUCTIONS:\n- Only update docs that are actually affected by this change\n- Keep updates concise and accurate\n- Don't add unnecessary documentation\n- If the change is purely code (no architectural/API changes), you may skip doc updates\n- Focus on: API changes, new features, architectural decisions, configuration changes\n\nUse the /heavy skill if you need multiple perspectives on what to document.\n"
}