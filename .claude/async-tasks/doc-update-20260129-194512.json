{
  "type": "doc-update",
  "created_at": "2026-01-29T19:45:12.876956+00:00",
  "status": "pending",
  "commit_message": "fix(hooks): prevent false positive git commit detection + unify debug log path\n\n1. doc-updater-async: Split Bash command by shell operators (&&, ||, ;, |)\n   and only match segments starting with 'git'. Prevents false positives when\n   \"git commit\" appears as a substring in echo/pipe arguments.\n\n2. auto-update: Use tempfile.gettempdir() instead of hardcoded /tmp/ for debug\n   log path. On macOS, tempfile returns /var/folders/.../ while /tmp is a\n   different location, causing split logs between hooks.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
  "diff_content": "commit 89170c7e80ba8ede3c4d3d319997859acc54ba2a\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Thu Jan 29 20:45:12 2026 +0100\n\n    fix(hooks): prevent false positive git commit detection + unify debug log path\n    \n    1. doc-updater-async: Split Bash command by shell operators (&&, ||, ;, |)\n       and only match segments starting with 'git'. Prevents false positives when\n       \"git commit\" appears as a substring in echo/pipe arguments.\n    \n    2. auto-update: Use tempfile.gettempdir() instead of hardcoded /tmp/ for debug\n       log path. On macOS, tempfile returns /var/folders/.../ while /tmp is a\n       different location, causing split logs between hooks.\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/auto-update.py       |  3 ++-\n config/hooks/doc-updater-async.py | 21 +++++++++++++++++++--\n 2 files changed, 21 insertions(+), 3 deletions(-)\n\ndiff --git a/config/hooks/auto-update.py b/config/hooks/auto-update.py\nindex d7da589..4378472 100755\n--- a/config/hooks/auto-update.py\n+++ b/config/hooks/auto-update.py\n@@ -27,6 +27,7 @@ import json\n import os\n import subprocess\n import sys\n+import tempfile\n from datetime import datetime, timedelta, timezone\n from pathlib import Path\n \n@@ -36,7 +37,7 @@ from pathlib import Path\n \n CHECK_INTERVAL_MINUTES = 5\n STATE_FILE = Path.home() / \".claude\" / \"toolkit-update-state.json\"\n-DEBUG_LOG = Path(\"/tmp/claude-hooks-debug.log\")\n+DEBUG_LOG = Path(tempfile.gettempdir()) / \"claude-hooks-debug.log\"\n \n \n def log_debug(message: str) -> None:\ndiff --git a/config/hooks/doc-updater-async.py b/config/hooks/doc-updater-async.py\nindex 5e5d775..0cc4333 100644\n--- a/config/hooks/doc-updater-async.py\n+++ b/config/hooks/doc-updater-async.py\n@@ -59,6 +59,22 @@ def matches_any_pattern(command: str, patterns: list[str]) -> bool:\n     return False\n \n \n+def has_actual_git_command(command: str, patterns: list[str]) -> bool:\n+    \"\"\"Check if any command segment is actually a git operation matching patterns.\n+\n+    Splits the command by shell operators (&&, ||, ;, |) and only matches\n+    segments that start with 'git'. This prevents false positives from\n+    commands like: echo '...git commit...' | python3 hook.py\n+    \"\"\"\n+    segments = re.split(r'\\s*(?:&&|\\|\\||;|\\|)\\s*', command)\n+    for segment in segments:\n+        segment = segment.strip()\n+        if segment.startswith(\"git \") or segment == \"git\":\n+            if matches_any_pattern(segment, patterns):\n+                return True\n+    return False\n+\n+\n def get_recent_commit_diff(cwd: str) -> tuple[str, str]:\n     \"\"\"Get the diff from the most recent commit.\n \n@@ -236,8 +252,9 @@ def main():\n     if not command:\n         sys.exit(0)\n \n-    # Check if this was a git commit\n-    if not matches_any_pattern(command, GIT_COMMIT_PATTERNS):\n+    # Check if this was a git commit (must be an actual git command segment,\n+    # not just the string \"git commit\" inside echo/pipe arguments)\n+    if not has_actual_git_command(command, GIT_COMMIT_PATTERNS):\n         sys.exit(0)\n \n     log_debug(f\"[doc-updater-async] Git commit detected: {command[:80]}\")",
  "existing_docs": [
    "docs/architecture.md",
    "docs/index.md",
    "docs/philosophy.md",
    "README.md",
    ".claude/MEMORIES.md"
  ],
  "instructions": "\nDOCUMENTATION UPDATE TASK\n\nA commit was just made in an appfix/godo session. Your job is to:\n\n1. Analyze the diff to understand what changed\n2. Determine which documentation files need updating\n3. Update the relevant docs to reflect the changes\n\nCOMMIT MESSAGE:\nfix(hooks): prevent false positive git commit detection + unify debug log path\n\n1. doc-updater-async: Split Bash command by shell operators (&&, ||, ;, |)\n   and only match segments starting with 'git'. Prevents false positives when\n   \"git commit\" appears as a substring in echo/pipe arguments.\n\n2. auto-update: Use tempfile.gettempdir() instead of hardcoded /tmp/ for debug\n   log path. On macOS, tempfile returns /var/folders/.../ while /tmp is a\n   different location, causing split logs between hooks.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\nEXISTING DOCUMENTATION FILES:\n- docs/architecture.md\n- docs/index.md\n- docs/philosophy.md\n- README.md\n- .claude/MEMORIES.md\n\nDIFF CONTENT:\ncommit 89170c7e80ba8ede3c4d3d319997859acc54ba2a\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Thu Jan 29 20:45:12 2026 +0100\n\n    fix(hooks): prevent false positive git commit detection + unify debug log path\n    \n    1. doc-updater-async: Split Bash command by shell operators (&&, ||, ;, |)\n       and only match segments starting with 'git'. Prevents false positives when\n       \"git commit\" appears as a substring in echo/pipe arguments.\n    \n    2. auto-update: Use tempfile.gettempdir() instead of hardcoded /tmp/ for debug\n       log path. On macOS, tempfile returns /var/folders/.../ while /tmp is a\n       different location, causing split logs between hooks.\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/auto-update.py       |  3 ++-\n config/hooks/doc-updater-async.py | 21 +++++++++++++++++++--\n 2 files changed, 21 insertions(+), 3 deletions(-)\n\ndiff --git a/config/hooks/auto-update.py b/config/hooks/auto-update.py\nindex d7da589..4378472 100755\n--- a/config/hooks/auto-update.py\n+++ b/config/hooks/auto-update.py\n@@ -27,6 +27,7 @@ import json\n import os\n import subprocess\n import sys\n+import tempfile\n from datetime import datetime, timedelta, timezone\n from pathlib import Path\n \n@@ -36,7 +37,7 @@ from pathlib import Path\n \n CHECK_INTERVAL_MINUTES = 5\n STATE_FILE = Path.home() / \".claude\" / \"toolkit-update-state.json\"\n-DEBUG_LOG = Path(\"/tmp/claude-hooks-debug.log\")\n+DEBUG_LOG = Path(tempfile.gettempdir()) / \"claude-hooks-debug.log\"\n \n \n def log_debug(message: str) -> None:\ndiff --git a/config/hooks/doc-updater-async.py b/config/hooks/doc-updater-async.py\nindex 5e5d775..0cc4333 100644\n--- a/config/hooks/doc-updater-async.py\n+++ b/config/hooks/doc-updater-async.py\n@@ -59,6 +59,22 @@ def matches_any_pattern(command: str, patterns: list[str]) -> bool:\n     return False\n \n \n+def has_actual_git_command(command: str, patterns: list[str]) -> bool:\n+    \"\"\"Check if any command segment is actually a git operation matching patterns.\n+\n+    Splits the command by shell operators (&&, ||, ;, |) and only matches\n+    segments that start with 'git'. This prevents false positives from\n+    commands like: echo '...git commit...' | python3 hook.py\n+    \"\"\"\n+    segments = re.split(r'\\s*(?:&&|\\|\\||;|\\|)\\s*', command)\n+    for segment in segments:\n+        segment = segment.strip()\n+        if segment.startswith(\"git \") or segment == \"git\":\n+            if matches_any_pattern(segment, patterns):\n+                return True\n+    return False\n+\n+\n def get_recent_commit_diff(cwd: str) -> tuple[str, str]:\n     \"\"\"Get the diff from the most recent commit.\n \n@@ -236,8 +252,9 @@ def main():\n     if not command:\n         sys.exit(0)\n \n-    # Check if this was a git commit\n-    if not matches_any_pattern(command, GIT_COMMIT_PATTERNS):\n+    # Check if this was a git commit (must be an actual git command segment,\n+    # not just the string \"git commit\" inside echo/pipe arguments)\n+    if not has_actual_git_command(command, GIT_COMMIT_PATTERNS):\n         sys.exit(0)\n \n     log_debug(f\"[doc-updater-async] Git commit detected: {command[:80]}\")\n\nINSTRUCTIONS:\n- Only update docs that are actually affected by this change\n- Keep updates concise and accurate\n- Don't add unnecessary documentation\n- If the change is purely code (no architectural/API changes), you may skip doc updates\n- Focus on: API changes, new features, architectural decisions, configuration changes\n\nUse the /heavy skill if you need multiple perspectives on what to document.\n"
}