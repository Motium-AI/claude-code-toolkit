{
  "type": "doc-update",
  "created_at": "2026-01-31T16:57:13.808436+00:00",
  "status": "pending",
  "commit_message": "docs(memory): document feedback loop \u2014 injection logging, utility tracking, auto-tuning\n\nUpdate Memory System v3 documentation to reflect closed feedback loop:\n- New memory_that_helped checkpoint field for citation tracking\n- Injection logging at SessionStart (prevents hallucinated event IDs)\n- Utility tracking at Stop (injection/citation counts in manifest.json)\n- Per-event demotion (3+ injections with 0 citations \u2192 50% penalty)\n- Auto-tuned MIN_SCORE via proportional controller (bounded [0.05, 0.25])\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
  "diff_content": "commit 02b3729b9464b4c278aa63756f58e12d380f4a99\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Sat Jan 31 17:57:13 2026 +0100\n\n    docs(memory): document feedback loop \u2014 injection logging, utility tracking, auto-tuning\n    \n    Update Memory System v3 documentation to reflect closed feedback loop:\n    - New memory_that_helped checkpoint field for citation tracking\n    - Injection logging at SessionStart (prevents hallucinated event IDs)\n    - Utility tracking at Stop (injection/citation counts in manifest.json)\n    - Per-event demotion (3+ injections with 0 citations \u2192 50% penalty)\n    - Auto-tuned MIN_SCORE via proportional controller (bounded [0.05, 0.25])\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n .claude/MEMORIES.md |  3 ++-\n docs/index.md       | 26 +++++++++++++++++++++++++-\n 2 files changed, 27 insertions(+), 2 deletions(-)\n\ndiff --git a/.claude/MEMORIES.md b/.claude/MEMORIES.md\nindex 82e6bd5..24c1173 100644\n--- a/.claude/MEMORIES.md\n+++ b/.claude/MEMORIES.md\n@@ -12,11 +12,12 @@\n \n **Cross-session learning** via append-only event store in `~/.claude/memory/{project-hash}/events/`.\n \n-- **Auto-capture**: Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), and `category` enum \u2014 archived on every successful stop\n+- **Auto-capture**: Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), `category` enum, and optional `memory_that_helped` (event IDs) \u2014 archived on every successful stop\n - **Auto-injection**: Top 10 relevant events injected at SessionStart via 4-signal scoring (entity 35%, recency 30%, quality 20%, source 15%)\n - **Entity matching**: Concept keywords (tools, errors, techniques, platforms) + file paths (basename, stem, dir)\n - **Dedup**: Prefix-hash guard (8-event lookback, 60-min window) prevents duplicates\n - **Manual capture**: `/compound` skill for deep LESSON/PROBLEM/CAUSE/FIX documentation\n+- **Feedback loop**: Injection logging at SessionStart, utility tracking at Stop, per-event demotion (3+ injections with 0 citations), auto-tuned MIN_SCORE via proportional controller (bounded [0.05, 0.25])\n \n See [docs/index.md](../docs/index.md#memory-system-v3) for full details.\n \ndiff --git a/docs/index.md b/docs/index.md\nindex 1ee31e1..240b1eb 100644\n--- a/docs/index.md\n+++ b/docs/index.md\n@@ -130,7 +130,7 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n \n ### How It Works\n \n-1. **Auto-capture** (primary path): `stop-validator` hook archives checkpoint as LESSON-first memory event on every successful stop. Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), and `category` (enum).\n+1. **Auto-capture** (primary path): `stop-validator` hook archives checkpoint as LESSON-first memory event on every successful stop. Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), `category` (enum), and optional `memory_that_helped` (event IDs from `<m>` tags).\n 2. **Manual capture** (deep captures): `/compound` skill for detailed LESSON/PROBLEM/CAUSE/FIX documentation\n 3. **Auto-injection**: `compound-context-loader` hook injects top 10 relevant events as structured XML at SessionStart\n 4. **Scoring**: 4-signal ranking \u2014 entity overlap (35%) + recency (30%) + content quality (20%) + source (15%)\n@@ -138,6 +138,30 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n 6. **Dedup**: Prefix-hash guard (8-event lookback, 60-min window) prevents duplicates\n 7. **Bootstrap filter**: Commit-message-level events automatically excluded from injection\n \n+### Feedback Loop & Auto-Tuning\n+\n+Memory System v3 includes a closed feedback loop to improve injection quality over time:\n+\n+1. **Injection logging**: `compound-context-loader` writes `injection-log.json` at SessionStart, recording which events were injected (prevents hallucinated event IDs in `memory_that_helped`)\n+2. **Utility tracking**: `stop-validator` validates `memory_that_helped` field against injection log, then records injection/citation counts in `manifest.json` under `\"utility\"` key\n+3. **Per-event demotion**: Events injected 3+ times with 0 citations receive a 0.5 score penalty (50% demotion), events injected 2 times with 0 citations receive 0.25 penalty\n+4. **Auto-tuned MIN_SCORE**: Proportional controller adjusts injection threshold based on aggregate citation rate (target: 15%). Activates after 20+ total injections, bounded to [0.05, 0.25]\n+5. **Stale utility cleanup**: Utility entries for deleted events are pruned during retention cleanup to keep manifest bounded\n+\n+**Utility data structure** (in `manifest.json`):\n+```json\n+{\n+  \"utility\": {\n+    \"events\": {\n+      \"evt_20260131T143022-12345-a1b2c3\": {\"injected\": 5, \"cited\": 2},\n+      \"evt_20260131T150000-67890-d4e5f6\": {\"injected\": 3, \"cited\": 0}\n+    },\n+    \"total_injected\": 47,\n+    \"total_cited\": 8\n+  }\n+}\n+```\n+\n ### Storage\n \n - **Location**: `~/.claude/memory/{project-hash}/events/evt_{timestamp}.json`",
  "existing_docs": [
    "docs/architecture.md",
    "docs/analysis-persistent-memory-for-harnesses.md",
    "docs/index.md",
    "docs/memory-integration-analysis.md",
    "docs/philosophy.md",
    "docs/audiobook-the-amnesiac-architect.md",
    "README.md",
    ".claude/MEMORIES.md"
  ],
  "instructions": "\nDOCUMENTATION UPDATE TASK\n\nA commit was just made in an repair/build session. Your job is to:\n\n1. Analyze the diff to understand what changed\n2. Determine which documentation files need updating\n3. Update the relevant docs to reflect the changes\n\nCOMMIT MESSAGE:\ndocs(memory): document feedback loop \u2014 injection logging, utility tracking, auto-tuning\n\nUpdate Memory System v3 documentation to reflect closed feedback loop:\n- New memory_that_helped checkpoint field for citation tracking\n- Injection logging at SessionStart (prevents hallucinated event IDs)\n- Utility tracking at Stop (injection/citation counts in manifest.json)\n- Per-event demotion (3+ injections with 0 citations \u2192 50% penalty)\n- Auto-tuned MIN_SCORE via proportional controller (bounded [0.05, 0.25])\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\nEXISTING DOCUMENTATION FILES:\n- docs/architecture.md\n- docs/analysis-persistent-memory-for-harnesses.md\n- docs/index.md\n- docs/memory-integration-analysis.md\n- docs/philosophy.md\n- docs/audiobook-the-amnesiac-architect.md\n- README.md\n- .claude/MEMORIES.md\n\nDIFF CONTENT:\ncommit 02b3729b9464b4c278aa63756f58e12d380f4a99\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Sat Jan 31 17:57:13 2026 +0100\n\n    docs(memory): document feedback loop \u2014 injection logging, utility tracking, auto-tuning\n    \n    Update Memory System v3 documentation to reflect closed feedback loop:\n    - New memory_that_helped checkpoint field for citation tracking\n    - Injection logging at SessionStart (prevents hallucinated event IDs)\n    - Utility tracking at Stop (injection/citation counts in manifest.json)\n    - Per-event demotion (3+ injections with 0 citations \u2192 50% penalty)\n    - Auto-tuned MIN_SCORE via proportional controller (bounded [0.05, 0.25])\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n .claude/MEMORIES.md |  3 ++-\n docs/index.md       | 26 +++++++++++++++++++++++++-\n 2 files changed, 27 insertions(+), 2 deletions(-)\n\ndiff --git a/.claude/MEMORIES.md b/.claude/MEMORIES.md\nindex 82e6bd5..24c1173 100644\n--- a/.claude/MEMORIES.md\n+++ b/.claude/MEMORIES.md\n@@ -12,11 +12,12 @@\n \n **Cross-session learning** via append-only event store in `~/.claude/memory/{project-hash}/events/`.\n \n-- **Auto-capture**: Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), and `category` enum \u2014 archived on every successful stop\n+- **Auto-capture**: Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), `category` enum, and optional `memory_that_helped` (event IDs) \u2014 archived on every successful stop\n - **Auto-injection**: Top 10 relevant events injected at SessionStart via 4-signal scoring (entity 35%, recency 30%, quality 20%, source 15%)\n - **Entity matching**: Concept keywords (tools, errors, techniques, platforms) + file paths (basename, stem, dir)\n - **Dedup**: Prefix-hash guard (8-event lookback, 60-min window) prevents duplicates\n - **Manual capture**: `/compound` skill for deep LESSON/PROBLEM/CAUSE/FIX documentation\n+- **Feedback loop**: Injection logging at SessionStart, utility tracking at Stop, per-event demotion (3+ injections with 0 citations), auto-tuned MIN_SCORE via proportional controller (bounded [0.05, 0.25])\n \n See [docs/index.md](../docs/index.md#memory-system-v3) for full details.\n \ndiff --git a/docs/index.md b/docs/index.md\nindex 1ee31e1..240b1eb 100644\n--- a/docs/index.md\n+++ b/docs/index.md\n@@ -130,7 +130,7 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n \n ### How It Works\n \n-1. **Auto-capture** (primary path): `stop-validator` hook archives checkpoint as LESSON-first memory event on every successful stop. Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), and `category` (enum).\n+1. **Auto-capture** (primary path): `stop-validator` hook archives checkpoint as LESSON-first memory event on every successful stop. Checkpoint requires `key_insight` (>30 chars), `search_terms` (2-7 concept keywords), `category` (enum), and optional `memory_that_helped` (event IDs from `<m>` tags).\n 2. **Manual capture** (deep captures): `/compound` skill for detailed LESSON/PROBLEM/CAUSE/FIX documentation\n 3. **Auto-injection**: `compound-context-loader` hook injects top 10 relevant events as structured XML at SessionStart\n 4. **Scoring**: 4-signal ranking \u2014 entity overlap (35%) + recency (30%) + content quality (20%) + source (15%)\n@@ -138,6 +138,30 @@ Consolidates `/deslop` + `/qa` into autonomous fix loop \u2192 3 detection agents s\n 6. **Dedup**: Prefix-hash guard (8-event lookback, 60-min window) prevents duplicates\n 7. **Bootstrap filter**: Commit-message-level events automatically excluded from injection\n \n+### Feedback Loop & Auto-Tuning\n+\n+Memory System v3 includes a closed feedback loop to improve injection quality over time:\n+\n+1. **Injection logging**: `compound-context-loader` writes `injection-log.json` at SessionStart, recording which events were injected (prevents hallucinated event IDs in `memory_that_helped`)\n+2. **Utility tracking**: `stop-validator` validates `memory_that_helped` field against injection log, then records injection/citation counts in `manifest.json` under `\"utility\"` key\n+3. **Per-event demotion**: Events injected 3+ times with 0 citations receive a 0.5 score penalty (50% demotion), events injected 2 times with 0 citations receive 0.25 penalty\n+4. **Auto-tuned MIN_SCORE**: Proportional controller adjusts injection threshold based on aggregate citation rate (target: 15%). Activates after 20+ total injections, bounded to [0.05, 0.25]\n+5. **Stale utility cleanup**: Utility entries for deleted events are pruned during retention cleanup to keep manifest bounded\n+\n+**Utility data structure** (in `manifest.json`):\n+```json\n+{\n+  \"utility\": {\n+    \"events\": {\n+      \"evt_20260131T143022-12345-a1b2c3\": {\"injected\": 5, \"cited\": 2},\n+      \"evt_20260131T150000-67890-d4e5f6\": {\"injected\": 3, \"cited\": 0}\n+    },\n+    \"total_injected\": 47,\n+    \"total_cited\": 8\n+  }\n+}\n+```\n+\n ### Storage\n \n - **Location**: `~/.claude/memory/{project-hash}/events/evt_{timestamp}.json`\n\nINSTRUCTIONS:\n- Only update docs that are actually affected by this change\n- Keep updates concise and accurate\n- Don't add unnecessary documentation\n- If the change is purely code (no architectural/API changes), you may skip doc updates\n- Focus on: API changes, new features, architectural decisions, configuration changes\n\nUse the /heavy skill if you need multiple perspectives on what to document.\n"
}