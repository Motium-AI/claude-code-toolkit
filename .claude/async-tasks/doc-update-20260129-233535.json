{
  "type": "doc-update",
  "created_at": "2026-01-29T23:35:35.614789+00:00",
  "status": "pending",
  "commit_message": "fix(hooks): add user-level state check to get_autonomous_state()\n\nThe get_autonomous_state() function was only checking project-level\nstate files, while is_appfix_active() and is_godo_active() also check\nuser-level state at ~/.claude/. This inconsistency caused auto-approval\nhooks to fail with \"Passthrough - state expired\" when working in a\ndifferent directory than where the skill was invoked.\n\nNow get_autonomous_state() checks both project-level and user-level\nstate files, matching the behavior of the other detection functions.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
  "diff_content": "commit 749f6c24ce39dd6966d513801c7304ee5fa91c83\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Fri Jan 30 00:35:35 2026 +0100\n\n    fix(hooks): add user-level state check to get_autonomous_state()\n    \n    The get_autonomous_state() function was only checking project-level\n    state files, while is_appfix_active() and is_godo_active() also check\n    user-level state at ~/.claude/. This inconsistency caused auto-approval\n    hooks to fail with \"Passthrough - state expired\" when working in a\n    different directory than where the skill was invoked.\n    \n    Now get_autonomous_state() checks both project-level and user-level\n    state files, matching the behavior of the other detection functions.\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/_common.py | 23 +++++++++++++++++++++++\n 1 file changed, 23 insertions(+)\n\ndiff --git a/config/hooks/_common.py b/config/hooks/_common.py\nindex 93651d5..8c41719 100755\n--- a/config/hooks/_common.py\n+++ b/config/hooks/_common.py\n@@ -388,6 +388,7 @@ def get_autonomous_state(cwd: str) -> tuple[dict | None, str | None]:\n     \"\"\"Get the autonomous mode state file and its type, filtering expired.\n \n     Checks for godo-state.json first, then appfix-state.json.\n+    Checks both project-level AND user-level state files.\n     Returns None for expired state files.\n \n     Args:\n@@ -397,14 +398,36 @@ def get_autonomous_state(cwd: str) -> tuple[dict | None, str | None]:\n         Tuple of (state_dict, state_type) where state_type is 'godo' or 'appfix'\n         Returns (None, None) if no state file found or all expired\n     \"\"\"\n+    # Check project-level godo state\n     godo_state = load_state_file(cwd, \"godo-state.json\")\n     if godo_state and not is_state_expired(godo_state):\n         return godo_state, \"godo\"\n \n+    # Check project-level appfix state\n     appfix_state = load_state_file(cwd, \"appfix-state.json\")\n     if appfix_state and not is_state_expired(appfix_state):\n         return appfix_state, \"appfix\"\n \n+    # Check user-level state files (for cross-directory support)\n+    # This matches the behavior of is_appfix_active() and is_godo_active()\n+    user_godo_path = Path.home() / \".claude\" / \"godo-state.json\"\n+    if user_godo_path.exists():\n+        try:\n+            user_godo_state = json.loads(user_godo_path.read_text())\n+            if not is_state_expired(user_godo_state):\n+                return user_godo_state, \"godo\"\n+        except (json.JSONDecodeError, IOError):\n+            pass\n+\n+    user_appfix_path = Path.home() / \".claude\" / \"appfix-state.json\"\n+    if user_appfix_path.exists():\n+        try:\n+            user_appfix_state = json.loads(user_appfix_path.read_text())\n+            if not is_state_expired(user_appfix_state):\n+                return user_appfix_state, \"appfix\"\n+        except (json.JSONDecodeError, IOError):\n+            pass\n+\n     return None, None",
  "existing_docs": [
    "docs/architecture.md",
    "docs/index.md",
    "docs/philosophy.md",
    "README.md",
    ".claude/MEMORIES.md"
  ],
  "instructions": "\nDOCUMENTATION UPDATE TASK\n\nA commit was just made in an appfix/godo session. Your job is to:\n\n1. Analyze the diff to understand what changed\n2. Determine which documentation files need updating\n3. Update the relevant docs to reflect the changes\n\nCOMMIT MESSAGE:\nfix(hooks): add user-level state check to get_autonomous_state()\n\nThe get_autonomous_state() function was only checking project-level\nstate files, while is_appfix_active() and is_godo_active() also check\nuser-level state at ~/.claude/. This inconsistency caused auto-approval\nhooks to fail with \"Passthrough - state expired\" when working in a\ndifferent directory than where the skill was invoked.\n\nNow get_autonomous_state() checks both project-level and user-level\nstate files, matching the behavior of the other detection functions.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\nEXISTING DOCUMENTATION FILES:\n- docs/architecture.md\n- docs/index.md\n- docs/philosophy.md\n- README.md\n- .claude/MEMORIES.md\n\nDIFF CONTENT:\ncommit 749f6c24ce39dd6966d513801c7304ee5fa91c83\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Fri Jan 30 00:35:35 2026 +0100\n\n    fix(hooks): add user-level state check to get_autonomous_state()\n    \n    The get_autonomous_state() function was only checking project-level\n    state files, while is_appfix_active() and is_godo_active() also check\n    user-level state at ~/.claude/. This inconsistency caused auto-approval\n    hooks to fail with \"Passthrough - state expired\" when working in a\n    different directory than where the skill was invoked.\n    \n    Now get_autonomous_state() checks both project-level and user-level\n    state files, matching the behavior of the other detection functions.\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/_common.py | 23 +++++++++++++++++++++++\n 1 file changed, 23 insertions(+)\n\ndiff --git a/config/hooks/_common.py b/config/hooks/_common.py\nindex 93651d5..8c41719 100755\n--- a/config/hooks/_common.py\n+++ b/config/hooks/_common.py\n@@ -388,6 +388,7 @@ def get_autonomous_state(cwd: str) -> tuple[dict | None, str | None]:\n     \"\"\"Get the autonomous mode state file and its type, filtering expired.\n \n     Checks for godo-state.json first, then appfix-state.json.\n+    Checks both project-level AND user-level state files.\n     Returns None for expired state files.\n \n     Args:\n@@ -397,14 +398,36 @@ def get_autonomous_state(cwd: str) -> tuple[dict | None, str | None]:\n         Tuple of (state_dict, state_type) where state_type is 'godo' or 'appfix'\n         Returns (None, None) if no state file found or all expired\n     \"\"\"\n+    # Check project-level godo state\n     godo_state = load_state_file(cwd, \"godo-state.json\")\n     if godo_state and not is_state_expired(godo_state):\n         return godo_state, \"godo\"\n \n+    # Check project-level appfix state\n     appfix_state = load_state_file(cwd, \"appfix-state.json\")\n     if appfix_state and not is_state_expired(appfix_state):\n         return appfix_state, \"appfix\"\n \n+    # Check user-level state files (for cross-directory support)\n+    # This matches the behavior of is_appfix_active() and is_godo_active()\n+    user_godo_path = Path.home() / \".claude\" / \"godo-state.json\"\n+    if user_godo_path.exists():\n+        try:\n+            user_godo_state = json.loads(user_godo_path.read_text())\n+            if not is_state_expired(user_godo_state):\n+                return user_godo_state, \"godo\"\n+        except (json.JSONDecodeError, IOError):\n+            pass\n+\n+    user_appfix_path = Path.home() / \".claude\" / \"appfix-state.json\"\n+    if user_appfix_path.exists():\n+        try:\n+            user_appfix_state = json.loads(user_appfix_path.read_text())\n+            if not is_state_expired(user_appfix_state):\n+                return user_appfix_state, \"appfix\"\n+        except (json.JSONDecodeError, IOError):\n+            pass\n+\n     return None, None\n\nINSTRUCTIONS:\n- Only update docs that are actually affected by this change\n- Keep updates concise and accurate\n- Don't add unnecessary documentation\n- If the change is purely code (no architectural/API changes), you may skip doc updates\n- Focus on: API changes, new features, architectural decisions, configuration changes\n\nUse the /heavy skill if you need multiple perspectives on what to document.\n"
}