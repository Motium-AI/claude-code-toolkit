{
  "type": "doc-update",
  "created_at": "2026-01-30T12:48:40.977957+00:00",
  "status": "pending",
  "commit_message": "feat(forge): add platform-aware verification (web + mobile)\n\n- Updated forge SKILL.md to detect mobile projects (app.json, eas.json, ios/, android/)\n- Mobile projects now require Maestro E2E testing instead of browser testing\n- Updated _sv_validators.py to support mobile testing validation in forge mode\n- Added Maestro MCP tools documentation for mobile verification\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
  "diff_content": "commit d25c6562835ec9cc60453f44d58ee543430dd2cd\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Fri Jan 30 13:48:40 2026 +0100\n\n    feat(forge): add platform-aware verification (web + mobile)\n    \n    - Updated forge SKILL.md to detect mobile projects (app.json, eas.json, ios/, android/)\n    - Mobile projects now require Maestro E2E testing instead of browser testing\n    - Updated _sv_validators.py to support mobile testing validation in forge mode\n    - Added Maestro MCP tools documentation for mobile verification\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/_sv_validators.py | 40 +++++++++++++++++++++++++++++-----------\n config/skills/forge/SKILL.md   | 25 ++++++++++++++++++++++---\n 2 files changed, 51 insertions(+), 14 deletions(-)\n\ndiff --git a/config/hooks/_sv_validators.py b/config/hooks/_sv_validators.py\nindex 53493a2..8bdc8fd 100644\n--- a/config/hooks/_sv_validators.py\n+++ b/config/hooks/_sv_validators.py\n@@ -23,6 +23,7 @@ from _common import (\n     is_repair_active,\n     is_appfix_active,\n     is_mobileappfix_active,\n+    is_forge_active,\n     is_autonomous_mode_active,\n     VERSION_DEPENDENT_FIELDS,\n )\n@@ -677,10 +678,10 @@ def validate_web_testing(\n def validate_mobile_testing(\n     checkpoint: dict, has_app_code: bool, cwd: str\n ) -> tuple[list[str], bool]:\n-    \"\"\"Check mobile testing requirements for mobileappfix mode.\n+    \"\"\"Check mobile testing requirements for mobile app projects.\n \n-    In mobileappfix mode, Maestro E2E verification is MANDATORY.\n-    This validates:\n+    In mobile mode (mobileappfix OR forge on mobile project), Maestro E2E\n+    verification is MANDATORY. This validates:\n     1. maestro_tests_passed is true with current version\n     2. Maestro smoke artifacts exist and passed\n     3. MCP tools were used (maestro_mcp_used)\n@@ -690,14 +691,20 @@ def validate_mobile_testing(\n     Maestro tests. This prevents false-positive mobile detection from\n     blocking non-mobile projects.\n \n+    NOTE: This function is now called for:\n+    - /mobileappfix mode (explicit mobile debugging)\n+    - /forge mode when is_mobile_project() returns True\n+\n+    The caller (validate_checkpoint) handles the mode detection logic.\n+\n     Returns (failures, checkpoint_modified)\n     \"\"\"\n     failures = []\n     report = checkpoint.get(\"self_report\", {})\n     checkpoint_modified = False\n \n-    if not is_mobileappfix_active(cwd):\n-        return failures, checkpoint_modified\n+    # Note: Mode detection is now done by the caller (validate_checkpoint)\n+    # This function focuses purely on mobile testing validation\n \n     # Safety net: Don't require Maestro tests if project isn't actually mobile\n     # This prevents false-positive mobile detection from blocking non-mobile projects\n@@ -799,11 +806,22 @@ def validate_checkpoint(\n     has_frontend = has_frontend_changes(modified_files)\n     failures.extend(validate_code_requirements(report, has_app_code, has_frontend))\n \n-    # 4. Web testing requirements (autonomous mode - web apps only)\n+    # 4. Determine if this is a mobile or web project\n     has_infra = report.get(\"az_cli_changes_made\", False)\n-    \n-    # Skip web testing for mobile mode - use Maestro instead\n-    if not is_mobileappfix_active(cwd):\n+\n+    # CRITICAL: Detect mobile projects for BOTH /mobileappfix AND /forge modes\n+    # This fixes the bug where /forge on a mobile app allowed web_testing_done: true\n+    # to bypass mobile testing requirements\n+    is_mobile_mode = is_mobileappfix_active(cwd)\n+    is_mobile = is_mobile_project(cwd)\n+\n+    # For forge mode: if project is mobile, require mobile testing\n+    if is_forge_active(cwd) and is_mobile and not is_mobile_mode:\n+        # Forge on mobile project - treat as mobile mode for testing requirements\n+        is_mobile_mode = True\n+\n+    # Web testing requirements (web apps only)\n+    if not is_mobile_mode:\n         web_failures, web_modified = validate_web_testing(\n             checkpoint, has_app_code, has_infra, cwd\n         )\n@@ -811,8 +829,8 @@ def validate_checkpoint(\n         if web_modified:\n             checkpoint_modified = True\n \n-    # 5. Mobile testing requirements (mobileappfix mode)\n-    if is_mobileappfix_active(cwd):\n+    # 5. Mobile testing requirements (mobileappfix mode OR forge on mobile project)\n+    if is_mobile_mode:\n         mobile_failures, mobile_modified = validate_mobile_testing(\n             checkpoint, has_app_code, cwd\n         )\ndiff --git a/config/skills/forge/SKILL.md b/config/skills/forge/SKILL.md\nindex acbcf2b..4a0dfb8 100644\n--- a/config/skills/forge/SKILL.md\n+++ b/config/skills/forge/SKILL.md\n@@ -73,9 +73,11 @@ TEST_PASSWORD=your-test-password\n - Copy from `.env.example` if available\n - Claude will ask once if credentials are missing, then expects them in `.env` for future use\n \n-## Browser Verification is MANDATORY\n+## Verification is MANDATORY (Platform-Aware)\n \n-**ALL forge sessions require browser verification. No exceptions.**\n+**ALL forge sessions require E2E verification. The type depends on your platform:**\n+\n+### Web Projects \u2192 Browser Testing (Surf CLI)\n \n | Task Type | Browser Verification Purpose |\n |-----------|------------------------------|\n@@ -85,7 +87,24 @@ TEST_PASSWORD=your-test-password\n | Config changes | Verify behavior changed |\n | API changes | Verify frontend integration works |\n \n-**The purpose of browser verification is to confirm the application works after your changes.**\n+### Mobile Projects \u2192 Maestro E2E Testing (MCP)\n+\n+**If the project contains `app.json`, `eas.json`, or `ios/`/`android/` directories, it's a mobile project and requires Maestro testing.**\n+\n+| Task Type | Maestro Verification Purpose |\n+|-----------|------------------------------|\n+| Feature implementation | Verify feature works on simulator |\n+| Bug fix | Verify bug is fixed via E2E tests |\n+| Refactoring | Verify app still works (J2 + J3 journeys) |\n+| Config changes | Verify behavior changed |\n+| API changes | Verify mobile app integration works |\n+\n+**Mobile projects MUST use Maestro MCP tools:**\n+- `mcp__maestro__run_flow()` - Run test journeys\n+- `mcp__maestro__hierarchy()` - Inspect element tree\n+- `mcp__maestro__screenshot()` - Capture screenshots\n+\n+**The purpose of verification is to confirm the application works after your changes.**\n \n ## Triggers",
  "existing_docs": [
    "docs/architecture.md",
    "docs/index.md",
    "docs/philosophy.md",
    "README.md",
    ".claude/MEMORIES.md"
  ],
  "instructions": "\nDOCUMENTATION UPDATE TASK\n\nA commit was just made in an appfix/godo session. Your job is to:\n\n1. Analyze the diff to understand what changed\n2. Determine which documentation files need updating\n3. Update the relevant docs to reflect the changes\n\nCOMMIT MESSAGE:\nfeat(forge): add platform-aware verification (web + mobile)\n\n- Updated forge SKILL.md to detect mobile projects (app.json, eas.json, ios/, android/)\n- Mobile projects now require Maestro E2E testing instead of browser testing\n- Updated _sv_validators.py to support mobile testing validation in forge mode\n- Added Maestro MCP tools documentation for mobile verification\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\nEXISTING DOCUMENTATION FILES:\n- docs/architecture.md\n- docs/index.md\n- docs/philosophy.md\n- README.md\n- .claude/MEMORIES.md\n\nDIFF CONTENT:\ncommit d25c6562835ec9cc60453f44d58ee543430dd2cd\nAuthor: olivier-motium <243932812+olivier-motium@users.noreply.github.com>\nDate:   Fri Jan 30 13:48:40 2026 +0100\n\n    feat(forge): add platform-aware verification (web + mobile)\n    \n    - Updated forge SKILL.md to detect mobile projects (app.json, eas.json, ios/, android/)\n    - Mobile projects now require Maestro E2E testing instead of browser testing\n    - Updated _sv_validators.py to support mobile testing validation in forge mode\n    - Added Maestro MCP tools documentation for mobile verification\n    \n    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n---\n config/hooks/_sv_validators.py | 40 +++++++++++++++++++++++++++++-----------\n config/skills/forge/SKILL.md   | 25 ++++++++++++++++++++++---\n 2 files changed, 51 insertions(+), 14 deletions(-)\n\ndiff --git a/config/hooks/_sv_validators.py b/config/hooks/_sv_validators.py\nindex 53493a2..8bdc8fd 100644\n--- a/config/hooks/_sv_validators.py\n+++ b/config/hooks/_sv_validators.py\n@@ -23,6 +23,7 @@ from _common import (\n     is_repair_active,\n     is_appfix_active,\n     is_mobileappfix_active,\n+    is_forge_active,\n     is_autonomous_mode_active,\n     VERSION_DEPENDENT_FIELDS,\n )\n@@ -677,10 +678,10 @@ def validate_web_testing(\n def validate_mobile_testing(\n     checkpoint: dict, has_app_code: bool, cwd: str\n ) -> tuple[list[str], bool]:\n-    \"\"\"Check mobile testing requirements for mobileappfix mode.\n+    \"\"\"Check mobile testing requirements for mobile app projects.\n \n-    In mobileappfix mode, Maestro E2E verification is MANDATORY.\n-    This validates:\n+    In mobile mode (mobileappfix OR forge on mobile project), Maestro E2E\n+    verification is MANDATORY. This validates:\n     1. maestro_tests_passed is true with current version\n     2. Maestro smoke artifacts exist and passed\n     3. MCP tools were used (maestro_mcp_used)\n@@ -690,14 +691,20 @@ def validate_mobile_testing(\n     Maestro tests. This prevents false-positive mobile detection from\n     blocking non-mobile projects.\n \n+    NOTE: This function is now called for:\n+    - /mobileappfix mode (explicit mobile debugging)\n+    - /forge mode when is_mobile_project() returns True\n+\n+    The caller (validate_checkpoint) handles the mode detection logic.\n+\n     Returns (failures, checkpoint_modified)\n     \"\"\"\n     failures = []\n     report = checkpoint.get(\"self_report\", {})\n     checkpoint_modified = False\n \n-    if not is_mobileappfix_active(cwd):\n-        return failures, checkpoint_modified\n+    # Note: Mode detection is now done by the caller (validate_checkpoint)\n+    # This function focuses purely on mobile testing validation\n \n     # Safety net: Don't require Maestro tests if project isn't actually mobile\n     # This prevents false-positive mobile detection from blocking non-mobile projects\n@@ -799,11 +806,22 @@ def validate_checkpoint(\n     has_frontend = has_frontend_changes(modified_files)\n     failures.extend(validate_code_requirements(report, has_app_code, has_frontend))\n \n-    # 4. Web testing requirements (autonomous mode - web apps only)\n+    # 4. Determine if this is a mobile or web project\n     has_infra = report.get(\"az_cli_changes_made\", False)\n-    \n-    # Skip web testing for mobile mode - use Maestro instead\n-    if not is_mobileappfix_active(cwd):\n+\n+    # CRITICAL: Detect mobile projects for BOTH /mobileappfix AND /forge modes\n+    # This fixes the bug where /forge on a mobile app allowed web_testing_done: true\n+    # to bypass mobile testing requirements\n+    is_mobile_mode = is_mobileappfix_active(cwd)\n+    is_mobile = is_mobile_project(cwd)\n+\n+    # For forge mode: if project is mobile, require mobile testing\n+    if is_forge_active(cwd) and is_mobile and not is_mobile_mode:\n+        # Forge on mobile project - treat as mobile mode for testing requirements\n+        is_mobile_mode = True\n+\n+    # Web testing requirements (web apps only)\n+    if not is_mobile_mode:\n         web_failures, web_modified = validate_web_testing(\n             checkpoint, has_app_code, has_infra, cwd\n         )\n@@ -811,8 +829,8 @@ def validate_checkpoint(\n         if web_modified:\n             checkpoint_modified = True\n \n-    # 5. Mobile testing requirements (mobileappfix mode)\n-    if is_mobileappfix_active(cwd):\n+    # 5. Mobile testing requirements (mobileappfix mode OR forge on mobile project)\n+    if is_mobile_mode:\n         mobile_failures, mobile_modified = validate_mobile_testing(\n             checkpoint, has_app_code, cwd\n         )\ndiff --git a/config/skills/forge/SKILL.md b/config/skills/forge/SKILL.md\nindex acbcf2b..4a0dfb8 100644\n--- a/config/skills/forge/SKILL.md\n+++ b/config/skills/forge/SKILL.md\n@@ -73,9 +73,11 @@ TEST_PASSWORD=your-test-password\n - Copy from `.env.example` if available\n - Claude will ask once if credentials are missing, then expects them in `.env` for future use\n \n-## Browser Verification is MANDATORY\n+## Verification is MANDATORY (Platform-Aware)\n \n-**ALL forge sessions require browser verification. No exceptions.**\n+**ALL forge sessions require E2E verification. The type depends on your platform:**\n+\n+### Web Projects \u2192 Browser Testing (Surf CLI)\n \n | Task Type | Browser Verification Purpose |\n |-----------|------------------------------|\n@@ -85,7 +87,24 @@ TEST_PASSWORD=your-test-password\n | Config changes | Verify behavior changed |\n | API changes | Verify frontend integration works |\n \n-**The purpose of browser verification is to confirm the application works after your changes.**\n+### Mobile Projects \u2192 Maestro E2E Testing (MCP)\n+\n+**If the project contains `app.json`, `eas.json`, or `ios/`/`android/` directories, it's a mobile project and requires Maestro testing.**\n+\n+| Task Type | Maestro Verification Purpose |\n+|-----------|------------------------------|\n+| Feature implementation | Verify feature works on simulator |\n+| Bug fix | Verify bug is fixed via E2E tests |\n+| Refactoring | Verify app still works (J2 + J3 journeys) |\n+| Config changes | Verify behavior changed |\n+| API changes | Verify mobile app integration works |\n+\n+**Mobile projects MUST use Maestro MCP tools:**\n+- `mcp__maestro__run_flow()` - Run test journeys\n+- `mcp__maestro__hierarchy()` - Inspect element tree\n+- `mcp__maestro__screenshot()` - Capture screenshots\n+\n+**The purpose of verification is to confirm the application works after your changes.**\n \n ## Triggers\n\nINSTRUCTIONS:\n- Only update docs that are actually affected by this change\n- Keep updates concise and accurate\n- Don't add unnecessary documentation\n- If the change is purely code (no architectural/API changes), you may skip doc updates\n- Focus on: API changes, new features, architectural decisions, configuration changes\n\nUse the /heavy skill if you need multiple perspectives on what to document.\n"
}